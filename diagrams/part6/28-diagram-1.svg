<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
  <!-- User Query -->
  <rect x="50" y="30" width="120" height="60" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" rx="5"/>
  <text x="110" y="65" text-anchor="middle" font-size="14" font-weight="bold">User Query</text>

  <!-- LLM -->
  <rect x="250" y="30" width="120" height="60" fill="#C8E6C9" stroke="#388E3C" stroke-width="2" rx="5"/>
  <text x="310" y="55" text-anchor="middle" font-size="14" font-weight="bold">Language</text>
  <text x="310" y="75" text-anchor="middle" font-size="14" font-weight="bold">Model</text>

  <!-- JSON Output -->
  <rect x="450" y="30" width="120" height="60" fill="#FFF9C4" stroke="#F57C00" stroke-width="2" rx="5"/>
  <text x="510" y="55" text-anchor="middle" font-size="14" font-weight="bold">JSON Tool</text>
  <text x="510" y="75" text-anchor="middle" font-size="14" font-weight="bold">Call</text>

  <!-- Tool Executor -->
  <rect x="630" y="30" width="120" height="60" fill="#BBDEFB" stroke="#1565C0" stroke-width="2" rx="5"/>
  <text x="690" y="55" text-anchor="middle" font-size="14" font-weight="bold">Tool</text>
  <text x="690" y="75" text-anchor="middle" font-size="14" font-weight="bold">Executor</text>

  <!-- Tool Result -->
  <rect x="630" y="150" width="120" height="60" fill="#C5E1A5" stroke="#558B2F" stroke-width="2" rx="5"/>
  <text x="690" y="175" text-anchor="middle" font-size="14" font-weight="bold">Tool</text>
  <text x="690" y="195" text-anchor="middle" font-size="14" font-weight="bold">Result</text>

  <!-- LLM Response -->
  <rect x="250" y="270" width="120" height="60" fill="#C8E6C9" stroke="#388E3C" stroke-width="2" rx="5"/>
  <text x="310" y="295" text-anchor="middle" font-size="14" font-weight="bold">LLM</text>
  <text x="310" y="315" text-anchor="middle" font-size="14" font-weight="bold">Response</text>

  <!-- Final Response -->
  <rect x="50" y="270" width="120" height="60" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" rx="5"/>
  <text x="110" y="295" text-anchor="middle" font-size="14" font-weight="bold">User</text>
  <text x="110" y="315" text-anchor="middle" font-size="14" font-weight="bold">Response</text>

  <!-- Arrows -->
  <defs>
    <marker id="arrowhead-tool" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666"/>
    </marker>
  </defs>

  <!-- Query to LLM -->
  <line x1="170" y1="60" x2="245" y2="60" stroke="#666" stroke-width="2" marker-end="url(#arrowhead-tool)"/>
  <text x="207" y="50" text-anchor="middle" font-size="11" fill="#666">"What's 2^64?"</text>

  <!-- LLM to JSON -->
  <line x1="370" y1="60" x2="445" y2="60" stroke="#666" stroke-width="2" marker-end="url(#arrowhead-tool)"/>
  <text x="407" y="45" text-anchor="middle" font-size="10" fill="#666">Generate</text>
  <text x="407" y="58" text-anchor="middle" font-size="10" fill="#666">structured</text>
  <text x="407" y="71" text-anchor="middle" font-size="10" fill="#666">output</text>

  <!-- JSON to Executor -->
  <line x1="570" y1="60" x2="625" y2="60" stroke="#666" stroke-width="2" marker-end="url(#arrowhead-tool)"/>
  <text x="597" y="50" text-anchor="middle" font-size="10" fill="#666">Parse &amp; call</text>

  <!-- Executor to Result -->
  <line x1="690" y1="90" x2="690" y2="145" stroke="#666" stroke-width="2" marker-end="url(#arrowhead-tool)"/>
  <text x="720" y="120" text-anchor="start" font-size="10" fill="#666">calculator(2^64)</text>

  <!-- Result back -->
  <path d="M 630 180 L 400 180 L 400 240 L 310 240 L 310 265" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead-tool)"/>
  <text x="500" y="170" text-anchor="middle" font-size="10" fill="#666">18446744073709551616</text>

  <!-- LLM to User -->
  <line x1="245" y1="300" x2="175" y2="300" stroke="#666" stroke-width="2" marker-end="url(#arrowhead-tool)"/>
  <text x="210" y="290" text-anchor="middle" font-size="10" fill="#666">Generate</text>
  <text x="210" y="302" text-anchor="middle" font-size="10" fill="#666">final answer</text>

  <!-- Labels for stages -->
  <text x="400" y="380" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">Tool Calling Loop</text>

  <!-- Stage numbers -->
  <circle cx="195" cy="60" r="12" fill="#FF5722" stroke="white" stroke-width="2"/>
  <text x="195" y="65" text-anchor="middle" font-size="11" fill="white" font-weight="bold">1</text>

  <circle cx="410" cy="60" r="12" fill="#FF5722" stroke="white" stroke-width="2"/>
  <text x="410" y="65" text-anchor="middle" font-size="11" fill="white" font-weight="bold">2</text>

  <circle cx="600" cy="60" r="12" fill="#FF5722" stroke="white" stroke-width="2"/>
  <text x="600" y="65" text-anchor="middle" font-size="11" fill="white" font-weight="bold">3</text>

  <circle cx="690" cy="120" r="12" fill="#FF5722" stroke="white" stroke-width="2"/>
  <text x="690" y="125" text-anchor="middle" font-size="11" fill="white" font-weight="bold">4</text>

  <circle cx="400" cy="180" r="12" fill="#FF5722" stroke="white" stroke-width="2"/>
  <text x="400" y="185" text-anchor="middle" font-size="11" fill="white" font-weight="bold">5</text>

  <circle cx="210" cy="300" r="12" fill="#FF5722" stroke="white" stroke-width="2"/>
  <text x="210" y="305" text-anchor="middle" font-size="11" fill="white" font-weight="bold">6</text>
</svg>
